<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L4958PW125"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-L4958PW125');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <title>Life in the UK – Secret Practice Quiz</title>
  <style>
    :root {
      --bg: #f5f7fb;
      --card-bg: #ffffff;
      --primary: #4f46e5;
      --border: #d0d4e4;
      --option-bg: #f7f8ff;
      --option-hover: #e6e9ff;
      --correct-bg: #d2f5dd;
      --correct-border: #65c27c;
      --incorrect-bg: #fbd5d5;
      --incorrect-border: #e55353;
      --text: #111827;
      --muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    .container {
      width: 100%;
      max-width: 1100px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      position: relative;
      overflow: hidden;
    }

    h1 {
      margin: 0 0 8px;
      font-size: 24px;
      text-align: center;
    }

    .subtext {
      margin: 0 0 20px;
      color: var(--muted);
      text-align: center;
    }

    .hidden {
      display: none;
    }

    button {
      cursor: pointer;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      padding: 12px 14px;
      transition: background 0.15s ease, transform 0.1s ease;
    }

    button.primary {
      background: var(--primary);
      color: #ffffff;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    button:not(:disabled):active {
      transform: translateY(1px);
    }

    .error {
      color: var(--incorrect-border);
      min-height: 20px;
      text-align: center;
      font-size: 14px;
    }

    .status-message {
      text-align: center;
      color: var(--correct-border);
      margin-top: 4px;
    }

    .quiz-body {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .category {
      color: var(--muted);
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .question {
      font-size: 18px;
      font-weight: 600;
      margin: 4px 0 8px;
    }

    .options {
      display: grid;
      gap: 10px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      background: var(--option-bg);
      border: 1px solid var(--border);
      color: var(--text);
    }

    .option-btn:hover:not(:disabled) {
      background: var(--option-hover);
    }

    .option-btn.correct {
      background: var(--correct-bg);
      border-color: var(--correct-border);
    }

    .option-btn.incorrect {
      background: var(--incorrect-bg);
      border-color: var(--incorrect-border);
    }

    .bottom-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .score {
      font-weight: 600;
      color: var(--text);
    }

    .final {
      text-align: center;
      display: grid;
      gap: 12px;
    }

    .setup {
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 16px;
      background: #f8f9ff;
      display: grid;
      gap: 12px;
    }

    .setup label {
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .setup input[type="number"] {
      width: 120px;
    }

    .progress-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      color: var(--muted);
      align-items: center;
    }

    .pill {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }

    .pill.correct {
      border-color: var(--correct-border);
      color: #0b8f3c;
    }

    .pill.incorrect {
      border-color: var(--incorrect-border);
      color: #c0392b;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 16px;
      align-items: start;
    }

    .drawer {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }

    .drawer button {
      width: fit-content;
    }

    .drawer-panel {
      width: 320px;
      max-width: calc(100vw - 48px);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
      padding: 14px;
      display: none;
      max-height: 75vh;
      overflow-y: auto;
    }

    .drawer-panel.active {
      display: block;
    }

    .learning-panel {
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fff;
      padding: 16px;
      display: none;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      max-height: 60vh;
      overflow-y: auto;
      margin-top: 12px;
    }

    .learning-panel.active {
      display: grid;
      gap: 12px;
    }

    .learning-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .learning-list {
      display: grid;
      gap: 12px;
    }

    .learning-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      background: #fdfdff;
      display: grid;
      gap: 8px;
    }

    .learning-card h4 {
      margin: 0;
      font-size: 16px;
    }

    .learning-card p {
      margin: 0;
      color: var(--muted);
    }

    .learning-loader {
      text-align: center;
      color: var(--muted);
      font-size: 14px;
    }

    .answer-row {
      border-bottom: 1px solid var(--border);
      padding: 10px 0;
      display: grid;
      gap: 6px;
    }

    .answer-row:last-child {
      border-bottom: none;
    }

    .answer-title {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-weight: 600;
      color: var(--text);
    }

    .answer-meta {
      font-size: 14px;
      color: var(--muted);
    }

    .tag {
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 12px;
      border: 1px solid var(--border);
      background: #f7f7ff;
    }

    .tag.correct {
      border-color: var(--correct-border);
      background: #e8f9ee;
      color: #0b8f3c;
    }

    .tag.incorrect {
      border-color: var(--incorrect-border);
      background: #ffecec;
      color: #c0392b;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      width: 100%;
    }

    .summary-card {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      background: #f9f9ff;
      text-align: center;
    }

    .accordion {
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
    }

    .accordion button {
      width: 100%;
      background: #fff;
      border: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 14px;
      font-weight: 600;
    }

    .accordion-content {
      display: none;
      padding: 0 14px 12px 14px;
      background: #fff;
    }

    .accordion-content.active {
      display: grid;
      gap: 10px;
    }

    .answer-detail {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px 12px;
      background: #fdfdff;
    }

    @media (max-width: 480px) {
      .card {
        padding: 18px;
      }
      .question {
        font-size: 17px;
      }
      .bottom-bar {
        flex-direction: column;
        align-items: stretch;
      }
      .layout {
        grid-template-columns: 1fr;
      }
      .drawer {
        position: static;
        align-items: stretch;
      }
      .drawer-panel {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Life in the UK – Secret Practice Quiz</h1>
      <p class="subtext" id="subtext">Practice freely and explore the answers instantly.</p>

      <div class="learning-header">
        <div class="tag" aria-live="polite" id="available-count"></div>
        <div style="display: flex; gap: 8px; align-items: center;">
          <button class="pill" id="learning-toggle" type="button">Open learning mode</button>
        </div>
      </div>

      <div class="learning-panel" id="learning-panel" aria-live="polite">
        <p class="subtext" style="margin: 0;">Scroll to load more questions with their answers.</p>
        <div class="learning-list" id="learning-list"></div>
        <div class="learning-loader" id="learning-loader">Loading questions…</div>
        <div id="learning-sentinel"></div>
      </div>

      <div id="quiz-section" class="quiz-body">
        <div class="setup" id="setup-section">
          <label for="question-count">How many questions do you want?
            <span class="tag" id="available-count-inline"></span>
          </label>
          <div class="progress-row">
            <input type="number" id="question-count" min="1" value="10" />
            <button class="primary" id="start-btn">Start quiz</button>
          </div>
          <div class="error" id="setup-error"></div>
        </div>

        <div class="layout">
          <div class="quiz-main">
            <div id="question-meta">
              <div class="category" id="category"></div>
              <div class="question" id="question"></div>
            </div>
            <div class="options" id="options"></div>
            <div class="progress-row" id="progress-row">
              <span class="pill" id="answered-pill">Answered: 0</span>
              <span class="pill correct" id="correct-pill">Correct: 0</span>
              <button class="pill incorrect" id="incorrect-pill" type="button">Wrong: 0</button>
            </div>
            <div class="bottom-bar">
              <div class="score" id="score">Score: 0</div>
              <button class="primary" id="next-btn" disabled>Next Question</button>
            </div>
            <div class="final hidden" id="final-screen">
              <h2 id="final-title">You're done!</h2>
              <p id="final-score"></p>
              <div class="summary-grid">
                <div class="summary-card" id="total-questions-card"></div>
                <div class="summary-card" id="total-correct-card"></div>
                <button class="summary-card" id="wrong-summary-btn" type="button"></button>
              </div>
              <div class="accordion" id="wrong-accordion" hidden>
                <button type="button" id="toggle-wrong">View wrong answers</button>
                <div class="accordion-content" id="wrong-list"></div>
              </div>
              <button class="primary" id="restart-btn">Restart Quiz</button>
            </div>
          </div>

          <div class="drawer">
            <button class="pill" id="drawer-toggle" type="button">Show answers ▸</button>
            <div class="drawer-panel" id="drawer-panel">
              <h3 style="margin-top: 0;">Live answer review</h3>
              <div id="answer-list"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const quizSection = document.getElementById("quiz-section");
      const categoryEl = document.getElementById("category");
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const scoreEl = document.getElementById("score");
      const nextBtn = document.getElementById("next-btn");
      const finalScreen = document.getElementById("final-screen");
      const finalScoreEl = document.getElementById("final-score");
      const restartBtn = document.getElementById("restart-btn");
      const setupSection = document.getElementById("setup-section");
      const questionCountInput = document.getElementById("question-count");
      const startBtn = document.getElementById("start-btn");
      const availableCount = document.getElementById("available-count");
      const availableCountInline = document.getElementById("available-count-inline");
      const setupError = document.getElementById("setup-error");
      const answeredPill = document.getElementById("answered-pill");
      const correctPill = document.getElementById("correct-pill");
      const incorrectPill = document.getElementById("incorrect-pill");
      const answerList = document.getElementById("answer-list");
      const drawerToggle = document.getElementById("drawer-toggle");
      const drawerPanel = document.getElementById("drawer-panel");
      const wrongSummaryBtn = document.getElementById("wrong-summary-btn");
      const wrongAccordion = document.getElementById("wrong-accordion");
      const wrongList = document.getElementById("wrong-list");
      const toggleWrong = document.getElementById("toggle-wrong");
      const totalQuestionsCard = document.getElementById("total-questions-card");
      const totalCorrectCard = document.getElementById("total-correct-card");
      const progressRow = document.getElementById("progress-row");
      const finalTitle = document.getElementById("final-title");
      const questionMeta = document.getElementById("question-meta");
      const learningToggle = document.getElementById("learning-toggle");
      const learningPanel = document.getElementById("learning-panel");
      const learningList = document.getElementById("learning-list");
      const learningLoader = document.getElementById("learning-loader");
      const learningSentinel = document.getElementById("learning-sentinel");

      let allQuestions = [];
      let questions = [];
      let currentIndex = 0;
      let score = 0;
      let answered = false;
      let answersLog = [];
      let learningIndex = 0;
      const LEARNING_BATCH = 15;
      let learningObserver = null;

      function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      function updatePills() {
        const totalAnswered = answersLog.length;
        const totalCorrect = answersLog.filter((a) => a.isCorrect).length;
        const totalWrong = totalAnswered - totalCorrect;
        answeredPill.textContent = `Answered: ${totalAnswered}/${questions.length || "-"}`;
        correctPill.textContent = `Correct: ${totalCorrect}`;
        incorrectPill.textContent = `Wrong: ${totalWrong}`;
      }

      function renderLearningBatch() {
        if (!allQuestions.length || learningIndex >= allQuestions.length) return;
        const slice = allQuestions.slice(learningIndex, learningIndex + LEARNING_BATCH);
        slice.forEach((item, idx) => {
          const card = document.createElement("article");
          card.className = "learning-card";

          const heading = document.createElement("h4");
          heading.textContent = `${learningIndex + idx + 1}. ${item.question}`;
          card.appendChild(heading);

          const answer = document.createElement("p");
          const answerText = item.options[item.answerIndex] ?? item.answer;
          answer.textContent = `Answer: ${answerText}`;
          card.appendChild(answer);

          learningList.appendChild(card);
        });
        learningIndex += slice.length;

        if (learningIndex >= allQuestions.length) {
          learningLoader.textContent = "You've seen every question.";
          if (learningObserver) learningObserver.disconnect();
        } else {
          learningLoader.textContent = "Loading more…";
        }
      }

      function setupLearningObserver() {
        if (learningObserver) return;
        learningObserver = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              renderLearningBatch();
            }
          });
        });
        learningObserver.observe(learningSentinel);
      }

      function toggleLearningPanel() {
        const isActive = learningPanel.classList.toggle("active");
        learningToggle.textContent = isActive ? "Hide learning mode" : "Open learning mode";
        if (isActive) {
          if (!learningObserver && allQuestions.length) {
            setupLearningObserver();
          }
          if (learningIndex === 0 && allQuestions.length) {
            renderLearningBatch();
          }
        }
      }

      function updateDrawer() {
        answerList.innerHTML = "";
        if (!answersLog.length) {
          answerList.innerHTML = '<p class="answer-meta">Your answers will appear here.</p>';
          return;
        }

        answersLog.forEach((entry) => {
          const row = document.createElement("div");
          row.className = "answer-row";
          const statusTag = `<span class="tag ${entry.isCorrect ? "correct" : "incorrect"}">${entry.isCorrect ? "Correct" : "Wrong"}</span>`;
          row.innerHTML = `
            <div class="answer-title">
              <span>Q${entry.number}</span>
              ${statusTag}
            </div>
            <div class="answer-meta">${entry.question}</div>
            <div><strong>Your answer:</strong> ${entry.selectedText ?? "—"}</div>
            <div><strong>Correct:</strong> ${entry.correctText}</div>
          `;
          answerList.appendChild(row);
        });
      }

      function updateWrongSummary() {
        const incorrectAnswers = answersLog.filter((a) => !a.isCorrect);
        wrongSummaryBtn.textContent = `Wrong answers (${incorrectAnswers.length})`;
        wrongSummaryBtn.disabled = !incorrectAnswers.length;
        if (incorrectAnswers.length) {
          wrongAccordion.hidden = false;
          buildWrongList(incorrectAnswers);
          wrongList.classList.remove("active");
          toggleWrong.textContent = "View wrong answers";
        } else {
          wrongAccordion.hidden = true;
          wrongList.innerHTML = "";
        }
      }

      function buildWrongList(list) {
        wrongList.innerHTML = "";
        list.forEach((entry) => {
          const detail = document.createElement("div");
          detail.className = "answer-detail";
          detail.innerHTML = `
            <div class="answer-title">
              <span>Q${entry.number}</span>
              <span class="tag incorrect">Incorrect</span>
            </div>
            <div class="answer-meta">${entry.question}</div>
            <div><strong>Your answer:</strong> ${entry.selectedText ?? "—"}</div>
            <div><strong>Correct answer:</strong> ${entry.correctText}</div>
          `;
          wrongList.appendChild(detail);
        });
      }

      function resetQuizState() {
        learningIndex = 0;
        learningList.innerHTML = "";
        learningLoader.textContent = allQuestions.length ? "Loading questions…" : "";
        if (learningObserver) {
          learningObserver.disconnect();
          learningObserver = null;
        }
        currentIndex = 0;
        score = 0;
        answered = false;
        answersLog = [];
        scoreEl.textContent = `Score: ${score}`;
        nextBtn.disabled = true;
        finalScreen.classList.add("hidden");
        questionMeta.classList.add("hidden");
        optionsEl.classList.add("hidden");
        nextBtn.classList.add("hidden");
        progressRow.classList.add("hidden");
        finalTitle.textContent = "You're done!";
        finalScoreEl.textContent = "";
        wrongSummaryBtn.textContent = "Wrong answers (0)";
        wrongSummaryBtn.disabled = true;
        wrongAccordion.hidden = true;
        wrongList.innerHTML = "";
        wrongList.classList.remove("active");
        toggleWrong.textContent = "View wrong answers";
        updatePills();
        updateDrawer();
      }

      function renderQuestion() {
        if (!questions.length) return;
        const item = questions[currentIndex];
        finalScreen.classList.add("hidden");
        categoryEl.textContent = item.category || "";
        questionEl.textContent = item.question || "";
        optionsEl.innerHTML = "";
        answered = false;
        nextBtn.disabled = true;
        questionMeta.classList.remove("hidden");
        optionsEl.classList.remove("hidden");
        nextBtn.classList.remove("hidden");
        progressRow.classList.remove("hidden");

        const correctIndex = item.answerIndex;
        if (correctIndex < 0) {
          questionEl.textContent = "This question has no valid answer configured.";
          return;
        }

        item.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.textContent = opt;
          btn.dataset.index = idx;
          btn.addEventListener("click", () => handleAnswer(btn, idx, correctIndex));
          optionsEl.appendChild(btn);
        });
      }

      function handleAnswer(button, selectedIndex, correctIndex) {
        if (answered) return;
        answered = true;
        const optionButtons = Array.from(optionsEl.querySelectorAll(".option-btn"));
        optionButtons.forEach((btn, idx) => {
          btn.disabled = true;
          if (idx === correctIndex) {
            btn.classList.add("correct");
          }
          if (idx === selectedIndex && idx !== correctIndex) {
            btn.classList.add("incorrect");
          }
        });
        if (selectedIndex === correctIndex) {
          score += 1;
          scoreEl.textContent = `Score: ${score}`;
        }
        const currentQuestion = questions[currentIndex];
        answersLog.push({
          number: currentIndex + 1,
          question: currentQuestion.question,
          selectedIndex,
          correctIndex,
          selectedText: currentQuestion.options[selectedIndex],
          correctText: currentQuestion.options[correctIndex],
          isCorrect: selectedIndex === correctIndex,
        });
        updatePills();
        updateDrawer();
        nextBtn.disabled = false;
      }

      function showFinalScreen() {
        const totalCorrect = answersLog.filter((a) => a.isCorrect).length;
        const totalWrong = (questions.length || 0) - totalCorrect;
        finalTitle.textContent = "Quiz completed";
        finalScoreEl.textContent = `You answered ${totalCorrect} correct and ${totalWrong} wrong out of ${questions.length}.`;
        totalQuestionsCard.textContent = `Total questions: ${questions.length}`;
        totalCorrectCard.textContent = `Correct: ${totalCorrect}`;
        wrongSummaryBtn.textContent = `Wrong answers (${totalWrong})`;
        wrongSummaryBtn.disabled = !totalWrong;
        updateWrongSummary();
        finalScreen.classList.remove("hidden");
        questionMeta.classList.add("hidden");
        optionsEl.classList.add("hidden");
        nextBtn.classList.add("hidden");
        progressRow.classList.add("hidden");
      }

      function nextQuestion() {
        if (!answered) return;
        if (currentIndex < questions.length - 1) {
          currentIndex += 1;
          renderQuestion();
        } else {
          showFinalScreen();
        }
      }

      function restartQuiz() {
        setupSection.classList.remove("hidden");
        resetQuizState();
      }

      function normalizeQuestions(data) {
        return data
          .map((item, idx) => {
            const answerIndex =
              typeof item.answer === "number"
                ? item.answer
                : item.options.indexOf(item.answer);
            if (answerIndex < 0 || answerIndex >= item.options.length) {
              console.warn(`Skipping question ${idx} due to invalid answer`, item);
              return null;
            }
            return { ...item, answerIndex };
          })
          .filter(Boolean);
      }

      async function loadQuestions() {
        try {
          const res = await fetch("/data/lifeinukquestions.json");
          if (!res.ok) throw new Error("Failed to load questions");
          const data = await res.json();
          allQuestions = normalizeQuestions(data);
          if (!allQuestions.length) throw new Error("No valid questions found");
          availableCount.textContent = `${allQuestions.length} available questions`;
          availableCountInline.textContent = `${allQuestions.length} available`;
          questionCountInput.max = allQuestions.length;
          resetQuizState();
          renderLearningBatch();
          setupLearningObserver();
        } catch (error) {
          setupError.textContent = "Unable to load quiz questions.";
          console.error(error);
        }
      }

      function startQuiz() {
        const requested = Number(questionCountInput.value);
        if (!Number.isInteger(requested) || requested <= 0) {
          setupError.textContent = "Enter a whole number greater than 0.";
          return;
        }
        if (!allQuestions.length) {
          setupError.textContent = "Questions are still loading. Please wait.";
          return;
        }
        const cappedCount = Math.min(requested, allQuestions.length);
        if (requested > allQuestions.length) {
          setupError.textContent = `Only ${allQuestions.length} questions available. We'll use that many.`;
        } else {
          setupError.textContent = "";
        }

        questions = shuffle(allQuestions.slice()).slice(0, cappedCount);
        resetQuizState();
        setupSection.classList.add("hidden");
        renderQuestion();
      }

      function toggleDrawer() {
        const isActive = drawerPanel.classList.toggle("active");
        drawerToggle.textContent = isActive ? "Hide answers ◂" : "Show answers ▸";
      }

      function toggleWrongList() {
        const isOpen = wrongList.classList.toggle("active");
        toggleWrong.textContent = isOpen ? "Hide wrong answers" : "View wrong answers";
      }

      startBtn.addEventListener("click", startQuiz);
      nextBtn.addEventListener("click", nextQuestion);
      restartBtn.addEventListener("click", restartQuiz);
      drawerToggle.addEventListener("click", toggleDrawer);
      learningToggle.addEventListener("click", toggleLearningPanel);
      wrongSummaryBtn.addEventListener("click", () => {
        wrongAccordion.scrollIntoView({ behavior: "smooth", block: "start" });
        toggleWrongList();
      });
      incorrectPill.addEventListener("click", () => {
        drawerPanel.classList.add("active");
        drawerToggle.textContent = "Hide answers ◂";
      });
      toggleWrong.addEventListener("click", toggleWrongList);
      loadQuestions();
    })();
  </script>
</body>
</html>
